<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="styles.css" media="screen" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    <script src="common.js"></script>
    <script src="no-scroll.js"></script>
    <meta charset="UTF-8">
    <title>LemIPC</title>
</head>
    <body>
        <div class="headerPage">
            <div class="container-fluid">
                <ul class="nav nav-pills">
                    <li role="presentation" class="active textNav"><a href="#">LemIPC</a></li>
                </ul>
            </div>
        </div>
        <div class="grid">
            <form id="sizeFrom" style="width: 400px;" class="formStyle">
                <div class="form-group">
                    <label for="sizeInput" class="sizeFont">Size</label>
                    <input type="text" class="form-control well well-lg" id="sizeInput" placeholder="Size">
                </div>
                <button type="submit" class="btn btn-default" id="submitButton">Submit</button>
                <div class="alert alert-danger" role="alert" id="alertInput">
                    <strong>Warning</strong> Please enter a greater than 5 and less than 12!
                </div>
            </form>
            <div class="canvas">
                <canvas id="demo" width="700" height="700"></canvas>
            </div>
        </div>
        <div class="footerPage">
            Developed by Yann Carlen and Quentin Muller
        </div>
    <script>
        $(document).ready(() => {
            const canva = $('#demo')
            const size = $('#sizeInput')
            const form = $('#sizeFrom')
            const alert = $('#alertInput')

            canva.hide()
            alert.hide()
            $('#submitButton').click(e => {
                e.preventDefault()
                const sizeNb = size.val()
                if (isNaN(sizeNb) || parseInt(sizeNb) < 5 || parseInt(sizeNb) > 12) {
                    alert.show()
                    return
                }
                axios.put('http://127.0.0.1:3030/api/map', { size: sizeNb })
                    .then(_ => {
                        alert.hide()
                        form.hide()
                        const socket = io.connect('http://127.0.0.1:3030')
                        start()
                        canva.show()
                        socket.on('pos', data => {
                            const entity = JSON.parse(data)
                            if (!Object.keys(players).length) {
                                players[`${entity.team}${entity.player}`] = entity
                                Game[`${entity.team}${entity.player}`] = Loader.getImage('player')
                            }
                            Object.keys(players).forEach(key => {
                                if (key === `${entity.team}${entity.player}`) {
                                    players[`${entity.team}${entity.player}`].x = entity.x
                                    players[`${entity.team}${entity.player}`].y = entity.y
                                }
                                players[`${entity.team}${entity.player}`] = entity
                                Game[`${entity.team}${entity.player}`] = Loader.getImage('player')
                            })
                            Game.render(map, players)
                        });
                    })
                    .catch(err => wesh(err))
            })
        })
    </script>
    </body>
</html>